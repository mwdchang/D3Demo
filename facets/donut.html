<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head>
<script src="http://d3js.org/d3.v3.min.js"></script>
</head>
<style>
body {
  font: 10px sans-serif;
  margin: 2em;
}
 
.arc path {
  stroke: #fff;
}
</style>
<body>
</body>
<script>

var data = [
{ key: 'A', val: 1, children:[
   { key: 'A1', size: Math.random()*300},
   { key: 'A2', size: Math.random()*300},
   { key: 'A3', size: Math.random()*300},
   { key: 'A4', size: Math.random()*300}, 
   { key: 'A5', size: Math.random()*300}, 
   { key: 'A6', size: Math.random()*300} 
   ]},
{ key: 'B', val: 1, children:[
   { key: 'B1', size: Math.random()*300},
   { key: 'B2', size: Math.random()*300},
   { key: 'B3', size: Math.random()*300}
]},
{ key: 'C', val: 1, children:[
   { key: 'C1', size: Math.random()*300},
   { key: 'C2', size: Math.random()*300}
]},
{ key: 'D', val: 1, children:[
   { key: 'D1', size: Math.random()*300},
   { key: 'D2', size: Math.random()*300},
   { key: 'D4', size: Math.random()*300},
   { key: 'D4', size: Math.random()*300}
]},
{ key: 'E', val: 1, children:[
   { key: 'E1', size: Math.random()*300}
]},
];
 
var width = 960,
    height = 500,
    radius = Math.min(width, height) / 4;
 
var color = d3.scale.ordinal()
    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);
 
var arc = d3.svg.arc()
    .outerRadius(radius - 20)
    .innerRadius(radius - 40);
 
var pie = d3.layout.pie()
    .sort(null)
    .startAngle(0)
    .value(function(d) { 
       return d.children.length; 
    });
 
var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
    .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
 

 
  data.forEach(function(d) {
    d.val = +d.val;
  });
 
  var g = svg.selectAll(".arc")
      .data(pie(data))
      .enter().append("g")
      .attr("class", "arc")
      .each(function(d, idx) {
         console.log(d.startAngle, d.endAngle, radius);

         var children = data[idx].children;
         var step = Math.abs( d.endAngle - d.startAngle)/children.length;
         var step_2 = step * 0.5;

         for (var i=0; i < children.length; i++) {
           var num = Math.ceil( children[i].size / 40);
           var arc = d3.svg.arc()
               .innerRadius(110)
               .outerRadius(17*num + radius)
               .startAngle(d.startAngle + (i*step)) 
               .endAngle(d.startAngle + (i+1)*step);

           svg.append("svg:path")
             .style("fill", "#EEEEEE")
             .style("stroke", "#888888")
             .style("opacity", 0.25)
             .attr("d", arc)
             .on("mouseover", function(d) {
                d3.select(this).style("fill", "#FFDD00");
             })
             .on("mouseout", function(d) {
                d3.select(this).style("fill", "#EEEEEE");
             });

           for (var j=0; j < num; j ++) {
             svg.append('circle')
               .attr('cx',  (17*j + radius) * Math.sin( step_2 + d.startAngle + i*step) )
               .attr('cy',  (17*j + radius) * -Math.cos( step_2 + d.startAngle + i*step) )
               .attr('r', 6)
               .attr('fill', function(d) {
                  return color(idx);
               });
           } 
         }

         /*
         svg.append('circle')
           .attr('cx',  radius * Math.sin( d.endAngle) )
           .attr('cy',  radius * -Math.cos( d.endAngle) )
           .attr('r', 10)
           .attr('fill', '#FF88FF');
           */

      });
 
  g.append("path")
      .attr("d", arc)
      .style("fill", function(d, i) { return color(i); });
 
  /* 
  g.append("text")
      .attr("transform", function(d) { return "translate(" + arc.centroid(d) + ")"; })
      .attr("dy", ".35em")
      .style("text-anchor", "middle")
      .text(function(d) { return d.data.key; });
      */
 
 
</script>
</html>

