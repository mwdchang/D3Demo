<html>
<head>
   <title> Facet Test </title>
   <script  src="d3.v3.min.js"></script>
   <style>
   body {
      font-family: Tahoma;
      font-size: 1rem;
   }
   </style>
</head>
<body style="margin:1.5em">
<div>
   <svg id="svg" width="700", height="500"></svg>
</div>
</body>
<script>

var rawData = [
];

var svg = d3.select("#svg");
var g1 = svg.append("g").attr("transform", "translate(0, 5)");
var g2 = svg.append("g").attr("transform", "translate(350, 5)");
var g3 = svg.append("g").attr("transform", "translate(0, 205)");
var g4 = svg.append("g").attr("transform", "translate(350, 205)");
var barWidth = 8;

renderSubSet("Facet 1", g1, [15, 20, 25, 30, 35, 40, 20, 22, 20, 70, 80, 20, 60, 15, 22, 56, 12, 25, 1, 64]);
renderSubSet("Facet 2", g2, [5, 0, 35, 20, 35, 15]);
renderSubSet("Facet 3", g3, [25, 10, 5, 70, 85, 15]);
renderSubSet("Facet 4", g4, [25, 10, 5, 30, 25, 15, 15]);


function renderSubSet(label, group, data) {

   var _data = data.map(function(d, i) {
         return {
            orig: d,
            val: d,
            index: i,
            group: label,
            shift: 0
         };
   });

   group.append("text").attr("x", 10).attr("y", 10).text(label);
   
   group.selectAll(".obar")
      .data(_data)
      .enter()
      .append("rect")
      .classed("obar", true)
      .attr("x", function(d) { return d.index * (barWidth+1); })
      .attr("y", function(d) { return (100 - d.orig); })
      .attr("width", barWidth)
      .attr("height", function(d) { return d.orig; })
      .attr("fill", d3.rgb(255, 255, 255))
      .attr("stroke", d3.rgb(230, 230, 230));

   group.selectAll(".bar")
      .data(_data)
      .enter()
      .append("rect")
      .classed("bar", true)
      .attr("x", function(d) { return d.index * (barWidth+1); })
      .attr("y", function(d) { return (100 - d.val); })
      .attr("width", barWidth)
      .attr("height", function(d) { return d.val; })
      .attr("fill", d3.rgb(88, 129, 172))
      .on("mouseover", function(d) {
         var shifts = svg.selectAll(".bar")
            .filter(function(d) { return ! (d.group === label); });

         shifts.each(function(d) {
            d.shift = Math.random()*d.orig;
         });

         shifts.transition()
            .duration(450)
            .attr("y", function(d) { return 100 - d.shift; })
            .attr("height", function(d) { return d.shift; });
      })
      .on("mouseout", function() {
         d3.selectAll(".bar")
           .transition()
           .duration(450)
           .attr("y", function(d) { return (100 - d.val); })
           .attr("height", function(d) { return d.val; });
      });


}


</script>
</html>
